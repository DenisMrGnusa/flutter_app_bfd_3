import 'dart:convert';
import 'package:flutter_test/flutter_test.dart';
import 'package:http/http.dart' as http;
import 'package:flutter_app_bfd_3/models/article.dart';

void main(){
  test("parse topstories.json", (){
    const jsonString = "[20721736,20721715,20719095,20714367,20714127,20720630,20719348,20712009,20720922,20720095,20722858,20721609,20721312,20721825,20717240,20720230,20718982,20722442,20713283,20701261,20722680,20717224,20720170,20713864,20720111,20720513,20721286,20721433,20721448,20701252,20716430,20716963,20697069,20715476,20722610,20723093,20719062,20722688,20718818,20706702,20722244,20717428,20723327,20715670,20717668,20717410,20716071,20710276,20709393,20723246,20715188,20713826,20722674,20717886,20721789,20707548,20711498,20715806,20708928,20706993,20712762,20718220,20707895,20710509,20711508,20703721,20711736,20705173,20711943,20710467,20712646,20704168,20713672,20713003,20711766,20699002,20710839,20720319,20720774,20713358,20713408,20715389,20718973,20708598,20721742,20708522,20712040,20712391,20700914,20722716,20703310,20722454,20705755,20713886,20716601,20710894,20706242,20708298,20701671,20721408,20708889,20710565,20714571,20713396,20716425,20713932,20711363,20717961,20707052,20722519,20706174,20700377,20698721,20708233,20698084,20708596,20712215,20708680,20718460,20704002,20703891,20707901,20717318,20699398,20711727,20694944,20707903,20710287,20702186,20696931,20709563,20696343,20705850,20719651,20698323,20711506,20701480,20699918,20717261,20706042,20708116,20705410,20714873,20720952,20707473,20717835,20706741,20699410,20698901,20699923,20695806,20698100,20718505,20698966,20708026,20705471,20719470,20704028,20720483,20711327,20709448,20696032,20697587,20698793,20705929,20705449,20711695,20698985,20695550,20712784,20714086,20695498,20710078,20707194,20716841,20696690,20707119,20707627,20703657,20712418,20701644,20709682,20703699,20714235,20719101,20713321,20696730,20697621,20698543,20696059,20716511,20720003,20718647,20718408,20712045,20718564,20700810,20694988,20709346,20711350,20716987,20719605,20697217,20696967,20718531,20707598,20706218,20704993,20709071,20710545,20708498,20713450,20712140,20702310,20698215,20697449,20718031,20709309,20697682,20711707,20711557,20719926,20702292,20696600,20707572,20704138,20712987,20715625,20701686,20706335,20712275,20717829,20710373,20703070,20704840,20699557,20696702,20708986,20711482,20714048,20712489,20711858,20715125,20707668,20698673,20702738,20706150,20708589,20713584,20717094,20702238,20709338,20707629,20711669,20700379,20700006,20705269,20716311,20708040,20707900,20718791,20702900,20704469,20711520,20711437,20695747,20703422,20710526,20695300,20709332,20712200,20698710,20718491,20698221,20704532,20703773,20702418,20696712,20711194,20697493,20712396,20708641,20704437,20713490,20712069,20701091,20704058,20700709,20696256,20700196,20707073,20699576,20716677,20711400,20709139,20710044,20711147,20712765,20708758,20704089,20712706,20694962,20718055,20707324,20712357,20704402,20701404,20710071,20707546,20703562,20709518,20702924,20701774,20697626,20708524,20702323,20707582,20702800,20694740,20701204,20706163,20710589,20710090,20696561,20698974,20709698,20701369,20698714,20704457,20717400,20705892,20699864,20701495,20698175,20697785,20697334,20697270,20702797,20702769,20695783,20695770,20702622,20704436,20701573,20704067,20705511,20703757,20699091,20698566,20698455,20702691,20696040,20695748,20701941,20709085,20701649,20699490,20712591,20701586,20698324,20698197,20698045,20697946,20695810,20704218,20695630,20704269,20699134,20719489,20706104,20701115,20710895,20701255,20711378,20700932,20712415,20717625,20697239,20696695,20695111,20705434]";
    expect(parseTopStories(jsonString).first, 20721736);
  });
  
  test("parse item.json", (){
    const jsonString = """{"by":"dhouston","descendants":71,"id":8863,"kids":[9224,8917,8952,8884,8887,8869,8958,8940,8908,9005,8873,9671,9067,9055,8865,8881,8872,8955,10403,8903,8928,9125,8998,8901,8902,8907,8894,8870,8878,8980,8934,8943,8876],"score":104,"time":1175714200,"title":"My YC app: Dropbox - Throw away your USB drive","type":"story","url":"http://www.getdropbox.com/u/2/screencast.html"}""";
    expect(parseArticle(jsonString).by, "dhouston");
  });

  test("parse item.json over a network", () async {
    final url = "https://hacker-news.firebaseio.com/v0/beststories.json";
    final res = await http.get(url);
    if(res.statusCode == 200) {
      final ids = json.decode(res.body);
      if(ids.isNotEmpty){
        final storyUrl = "https://hacker-news.firebaseio.com/v0/item/${ids.first}.json";
        final storyRes = await http.get(storyUrl);
        if(storyRes.statusCode == 200){
          expect(parseArticle(storyRes.body).by, "RickJWagne");
        }
      }
    }
  });
}